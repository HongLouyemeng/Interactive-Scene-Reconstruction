<launch>

  <!-- sequence -->
  <arg name="sequence" default="vrep" />
  <arg name="use_vrep" default="true" />

  <!-- mode parameters -->
  <arg name="mapping" default="true" />
  <arg name="compute_localization" default="true" />
  <arg name="pub_point_cloud" default="true" />
  <arg name="localize_only" default="false" />
  <arg name="load_map" default="false" />
  <arg name="map_file" default="test.bin" />
  <!-- <arg name="map_file" default="VCLA38781.bin" /> -->
  <arg name="check_dynamic" default="false" />
  <arg name="GT_available" default="true" />
  <arg name="use_GT_mapping" default="false" />

  <!-- topic parameters -->
  <arg name="rgb_raw_topic" default="camera/rgb/image_color" />
  <arg name="rgb_info_topic" default="camera/rgb/camera_info" />
  <arg name="depth_raw_topic" default="camera/depth/image_raw" />
  <arg name="depth_info_topic" default="camera/depth/camera_info" />

  <!-- <arg name="depth_register_topic" default="camera/depth_registered/image" /> -->

  <!-- frame parameters -->
  <arg name="camera_frame" default="camera_link" />
  <arg name="rgb_frame_id" default="openni_rgb_optical_frame" />
  <arg name="depth_frame_id" default="openni_depth_optical_frame" />

  <!-- detection parameters -->
  <arg name="enable_openpose" default="false" />
  <arg name="enable_detectron" default="true" />
  <arg name="detectron_model" default="Pano_seg" />


  <!-- launch node for visualization -->
  <!-- <node name="rviz" pkg="rviz" type="rviz" required="true" args="-d $(find orb_slam2_ros)/rviz_cfg/TUM1.rviz" /> -->
    
  <!-- launch node for detection -->
  <include file="$(find perception_ros)/launch/robot_perception.launch" >
      <arg name="use_vrep" value="$(arg use_vrep)" />  
      <!-- <arg name="check_dynamic" value="$(arg check_dynamic)" />  -->
      <arg name="pub_point_cloud" value="$(arg pub_point_cloud)" /> 
      <arg name="camera_frame" value="$(arg camera_frame)" />
      <arg name="use_GT_mapping" value="$(arg use_GT_mapping)" />
      
      <arg name="rgb_raw_topic" value="$(arg rgb_raw_topic)" />
      <arg name="rgb_info_topic" value="$(arg rgb_info_topic)" />
      <!-- <arg name="depth_raw_topic" value="$(arg depth_register_topic)" /> -->
      <arg name="depth_raw_topic" value="$(arg depth_raw_topic)" />
      <arg name="depth_info_topic" value="$(arg depth_info_topic)" />
      <!-- <arg name="depth_register_topic" value="$(arg depth_register_topic)" /> -->
      <arg name="enable_openpose" value="$(arg enable_openpose)" />
      <arg name="enable_detectron" value="$(arg enable_detectron)" />
      <arg name="detectron_model" value="$(arg detectron_model)" />
      
  </include>

  <!-- launch node for SLAM -->
  <include file="$(find orb_slam2_ros)/ros/launch/orb_slam2_RGBD.launch" if="$(arg compute_localization)" >
      <arg name="sequence" value="$(arg sequence)" />
      <arg name="localize_only" value="$(arg localize_only)" />
      <arg name="load_map" value="$(arg load_map)" />
      <arg name="map_file" value="$(arg map_file)" />
      <arg name="check_dynamic" value="$(arg check_dynamic)" />

      <arg name="camera_frame_id" value="$(arg camera_frame)" />
      <arg name="camera_frame_GT_id" value="$(arg rgb_frame_id)" />
      <arg name="use_vrep" value="$(arg use_vrep)" />  
      <arg name="GT_available" value="$(arg GT_available)" />  
      <!-- use default input topics from perception_node -->
      <!-- <arg name="rgb_raw_topic" value="$(arg rgb_raw_topic)" />
      <arg name="depth_raw_topic" value="$(arg depth_raw_topic)" />  -->
      <!-- <arg name="depth_raw_topic" value="$(arg depth_register_topic)" />  -->
      

  </include>

  <node name="gsm_node" pkg="gsm_node" type="gsm_node" output="screen" if="$(arg mapping)">
      <rosparam command="load" file="$(find gsm_node)/cfg/default.yaml" />
      <rosparam command="load" file="$(find gsm_node)/cfg/pano_mapping.yaml" />
      <param name="meshing/visualize" value="true" />
      <param name="ground_axis" type="int" value="2" />
  </node>


</launch>
